<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>JCDM | Guardando contacto…</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <script>
    // --- Config ---
    const VCF_URL = './files/juan-carlos-delgado.vcf'; // ajusta ruta/nombre si cambia
    const MEAS_ID = 'G-85LR7PFMVT';

    // Carga GA4 solo si no viene del header global
    (function ensureGA(){
      if (window.gtag) return;
      var s = document.createElement('script');
      s.async = true;
      s.src = 'https://www.googletagmanager.com/gtag/js?id=' + MEAS_ID;
      document.head.appendChild(s);
      window.dataLayer = window.dataLayer || [];
      window.gtag = function(){ dataLayer.push(arguments); };
      gtag('js', new Date());
      gtag('config', MEAS_ID, { transport_type: 'beacon' });
    })();

    // Utilidad: lee ?qr=... para etiquetar distintas tarjetas
    function getQRId(){
      const u = new URL(location.href);
      return u.searchParams.get('qr') || 'business-card';
    }

    // Dispara 1 sola vez por sesión
    function fireQRScanOnce(){
      const key = 'qr_scan_fired';
      if (sessionStorage.getItem(key)) return false;
      sessionStorage.setItem(key, '1');
      return true;
    }

    // Dispara el evento y redirige al vCard
    document.addEventListener('DOMContentLoaded', function(){
      if (fireQRScanOnce()) {
        gtag('event', 'qr_scan', {
          event_category: 'QR',
          event_label: 'Business Card vCard',
          qr_id: getQRId(),          // <- parámetro personalizado
          value: 1
        });
      }
      setTimeout(function(){ location.href = VCF_URL; }, 500);
    });
  </script>

  <style>
    :root { --gold:#d4af37; --bg:#0b0b0b; --text:#e9e9e9 }
    html,body{height:100%}
    body{
      margin:0;display:grid;place-items:center;height:100vh;
      background: radial-gradient(1200px 600px at 50% -10%, #141414 0%, var(--bg) 60%);
      color:var(--text); font:500 16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }
    .card{
      text-align:center; padding:32px 28px; width:min(520px,92vw);
      border:1px solid rgba(212,175,55,.18); background:rgba(255,255,255,.02);
      border-radius:16px; box-shadow:0 8px 28px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
      backdrop-filter:blur(6px)
    }
    h1{margin:0 0 .25rem; font-size:clamp(20px,4vw,28px); letter-spacing:.02em}
    .brand{color:var(--gold); font-weight:700}
    p{margin:.25rem 0 .75rem; opacity:.85}
    a{color:var(--gold); text-decoration:underline}
    .spinner{width:28px;height:28px;margin:10px auto 0;border-radius:50%;
      border:3px solid rgba(212,175,55,.25); border-top-color:var(--gold); animation:spin .7s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <main class="card" role="main" aria-live="polite">
    <h1><span class="brand">JCDM</span> Technologies LLC</h1>
    <p>Guardando contacto…</p>
    <div class="spinner" aria-hidden="true"></div>
    <p style="margin-top:12px">Si no te redirige automáticamente, <a href="./files/juan-carlos-delgado.vcf">toca aquí</a>.</p>
  </main>
  <noscript>
    <p style="text-align:center;color:#d4af37">JavaScript está desactivado. Abre <a href="./files/juan-carlos-delgado.vcf" style="color:#d4af37">este enlace</a> para guardar el contacto.</p>
  </noscript>
</body>
</html>
